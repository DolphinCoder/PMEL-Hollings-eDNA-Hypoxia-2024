---
title: "NEMO Data Exploration"
author: "Eleanor (Ella) Crotty"
header-includes:
  \usepackage{fvextra}
  \DefineVerbatimEnvironment{Highlighting}{Verbatim}{breaklines,commandchars=\\\{\}}
output:
  pdf_document:
    toc: TRUE
urlcolor: blue
---

```{r Package Imports, message = F, warning = F}
# Warnings and startup messages suppressed
library(tidyverse)
library(patchwork)
library(scales)
library(ggrepel)
library(readxl)
library(here)
library(R.matlab)
```
[MATLAB File Import Tutorial](https://www.kaggle.com/code/rtatman/reading-mat-files-into-r)

[Google Doc of all the variable names](https://docs.google.com/document/d/1SiRRqH9jys-Y2ktuFyQ8E0s6KkJ8H664Lvph6HtfY78/edit)

```{r}
NEMO21 <- readMat(here("OCNMS_Hypoxia", "Data", "NEMO_Data", "MPall_nemo21a_sn106.mat"))
NEMO22 <- readMat(here("OCNMS_Hypoxia", "Data", "NEMO_Data", "MPall_nemo22a_sn106.mat"))
NEMO23 <- readMat(here("OCNMS_Hypoxia", "Data", "NEMO_Data", "MPall_nemo23a_sn106.mat"))
# str(NEMO21) # Data structure
# print(NEMO21)
```

Date format [datenum](https://www.mathworks.com/help/matlab/ref/datenum.html)
Date format conversion [datenum to POSIXct](https://stackoverflow.com/questions/30072063/how-to-extract-the-time-using-r-from-a-matlab-serial-date-number)

```{r}
lst <- NEMO23$MPall
# datenum
# dox = dissolved oxygen?
# t = temperature?
# id
# yday
# doxr?
# z
# lat
# lon
# year
# cruise
# comment
datenum23 <- c(lst[[1]]) # datenums as vector
metadata23 <- lst[[38]]
dates23 <- as.POSIXct((datenum23 - 719529)*86400, origin = "1970-01-01", tz = "UTC") # subtract to get origin = January 0, 0000 (this is a made up date so as.POSIXct won't handle it natively), need to multiply by seconds in a day to go from datenum (days since made up Matlab epoch) to POSIXct (seconds since Unix epoch). Just kinda hoping they were using UTC here.
print(length(datenum23) == length(dates23))

# These look pretty much correct, starting in May 2023

dox23 <- c(lst[[11]])
```

```{r}
data.frame(dates23, dox23)
```

